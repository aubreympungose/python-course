{"title":"4 Data Wrangling and Manipulation","markdown":{"yaml":{"title":"4 Data Wrangling and Manipulation","code-copy":true,"code-line-numbers":true,"tidy":true,"code-annotations":"below"},"headingText":"4.1 PART I","containsRefs":false,"markdown":"\n\n\n\n## Learning objectives\n\n-   Understand dataframes\n\n-   Manipulate, transform and analyse dataframes\n\n## 4.1.1 Introduction\n\nDataframes, as we saw [the previous section](/weeks/week-2.html), is a tabular data format, with columns and rows. Columns are *variable* names and rows are individual *observations*. \n\nLet us a basic data frame with three columns: country, life expectancy, and population of Southern African countries. First, we create individual vectors:\n\n```{r create a dataframe}\n\n# Create a character vector\ncountry_name <- c(\"Angola\", \"Botswana\", \"Lesotho\", \"Malawi\", \"Mozambique\", \"Namibia\", \"South Africa\", \"Swaziland\", \"Zambia\", \"Zimbabwe\")\n\ncountry_name\n\n## Create a numeric vector\n\nlife_expectancy <- c(61.6, 61.1, 57.1, 53.1, 62.9, 59.3, 59.3, 62.3, 61.2, 59.3)\n\nlife_expectancy\n\n## create another numeric vector\n\npopulation <- c(34500000, 2590000, 228000, 19890000, 32080000,  2530000, 59390000, 1190000, 19470000, 1599000)\n```\n\nBecause we have 3 vectors of equal length, we can create a dataframe, using a `data.frame()` function:\n\n```{r first_dataframe}\n\nsouthern_africa_df <- data.frame(country_name, life_expectancy, population) #combine two vectors to create a dataframe\n\nsouthern_africa_df ## print the dataframe\n```\n\nA dataframe is basically made of vectors (columns). In the `southern_africa_df` dataframe, we have `r ncol(southern_africa_df)` columns: `country_name`, `life_expectancy` `population`. We can extract these elements using the `$` sign:\n\n```{r extract vector}\nsouthern_africa_df$country_name\n\nsouthern_africa_df$life_expectancy\n\nsouthern_africa_df$population\n```\n\n\n## 4.1.3 Using `dplyr`\n\nWe will use  the `dplyr` package to manipulate data. `dplyr` is part of `tidyverse` meta-package and is mostly used to clean, manipulate and transform dataframes. `dplyr` has 5 main verbs/functions:\n\n-   `select()`: for selecting particular columns in a dataframe\n\n-   `filter()`: for sub-setting rows based on the specified criteria\n\n-   `arrange()`: sort rows/observations based (ascending/descending)\n\n-   `summarise()`: for summary statistics\n\n-   `mutate()`: create new columns based on the manipulation of the existing columns.\n\n- `group_by()`: get aggregate statistics by a category\n\n```{r load dplyr, warning=FALSE}\nlibrary(dplyr)\n```\n\nYou can also load `dplyr` by loading the `tidyverse` package; this will load all the packages in in `tidyverse at once. This is useful, for example, when you want to clean and visualise data:\n\n```{r load tidyverse_2, warning=FALSE}\nlibrary(tidyverse)\n```\n\nNote that you will net to install tidyverse if you did not install it from the previous section:\n\n```{r install tidyverse, echo=FALSE}\n\ninstall.packages(\"tidyverse\")\n```\n\n\nLet us load the `gapminder` dataset that we used from the previous week. If you did not install, you will need to do so.\n\n```{r load gapminder}\nlibrary(gapminder)\n```\n\nThan assign it to the object, `gapminder`, using the `<-` operator:\n\n```{r assign gapminder}\n\ngapminder <- gapminder\n\n```\n\nWrite the following code to change the country and continent from factor to character, I will explain this in the next chapter:\n\n```{r to character}\ngapminder$country <- as.character(gapminder$country)\n\ngapminder$continent <- as.character(gapminder$continent)\n```\n\n\nNow you have an object, which is a dataframe, called `gapminder`, you can see it in the `Environment` pane in RStudio. It shows that it has `ncol(gapminder)` columns/variables and `nrow(gapminder)` observations/rows\n\n![`gapminder` dataframe in Environment pane](images/environment_pane.png)\n\nYou can use the `str()` fucntion to get the structure of the dataframe:\n\n```{r structure of gapminder}\n\nstr(gapminder)\n```\n\nWe have 6 variables:\n\n- \"country\" \n\n- \"continent\" \n\n- \"year\"      \n\n- \"lifeExp\": life expectancy of a country  \n\n- \"pop\": population     \n\n- \"gdpPercap\": GDP per capita\n\nYou can get a sample of the first observations/rows using `head()` function:\n\n```{r head}\nhead(gapminder)\n```\n\n### 4.1.4 `select()` function\n\nWe may be interested in some of the columns in the `gampminder` dataframe, let say, for example, \"country\" and \"pop\" variables and discard others; we use the `select()` function:\n\n```{r select}\nlibrary(dplyr)\nselect(gapminder, \"country\", \"pop\")\n```\n\nR return only the country and population variables. `select()` function only return the variables/columns we are interested in:\n\n![](images/visualise_select.png)\n\n\n### The pipe operator (`|>`)\n\nThe best way to work with R, esepcially tidyverse, is using the pipe (`|>`) operator. The pipe connect various tasks, for example:\n\n```{r pipe}\ngapminder |>\n  select(country, pop)\n```\n\nThe pipe chains your operations. It says:\n\n- Take `gapminder` dataframe\n\n- Then using the `select()` function to select only pop and country columns\n\nYou will that pipe becomes important when having multiple chains of functions at once.\n\nYou will notice that in other sources: web, books, etc. have %>% instead of |>. It works the same way. The |> is new. %>% comes from `mgttr`, an external package, so you needed to load it first before using it. The  native pipe |> is built in R, so it there is no need to load it. So, we will stick with the |>.\n\nIn your RStudio, follow these instructions:\n\n- Go to 'Tools' and click on 'Global Options'\n\n- Navigate to 'Code' on the left pane\n\n- Then select the fourth option, \"use native pipe operator, |>\"\n\n- Click 'Apply'\n\nYou can use the short cut `Ctrl + Shift + M ` If you using Windows to insert the pipe instead of typing it. If you are using Mac, use `Cmd + Shift + M`. \n\n### 4.1.4 Return to `select()` function\n\nAs I have said, `select()` only return the columns specified\n\n\n```{r pipe magttr}\n\ngapminder %>% \n  select(country, pop)\n```\n\nAlso, notice that we selected \"country' and \"pop\" columns but did not save them and assigned to an object. To store the results into an object, we have to use assignment operator (`<-`):\n\n```{r assign}\ngapminder_selected <- gapminder |>\n  select(country, pop)\n\ngapminder_selected # print\n```\n\nNow we have saved results as `gapminder_selected`, and we can do other analysis with this object because we have saved it. So, in a nutshell, when you run a code without assigning results into an object, using the `<-` operator, **results will not be saved but will be printed**.\n\nYou can also select columns based by index/position. Let us select only 1st and 3rd coulmns\n\n```{r select index}\ngapminder |> \n  select(1, 3)\n```\n\nOr you can select a range of columns\n\n```{r select_range}\ngapminder |> \n  select(country:year)\n```\n\nHere, we have select columns from country to year only.\n\nYou can also exclude certain columns by simply adding the minus (-) sign; let say we want to exclude the `gdpPercap` from the dataframe\n\n```{r select_minus}\ngapminder |> \n  select(-gdpPercap)\n```\n\n### 4.1.5 `filter()` function\n\nYou may be interested in observations/rows that meet certain conditions. We use `filter()` function to return the list that meet our conditions. `filter()` has several operators:\n\n- `==`: equal to\n\n- `!=`: not equal to\n\n- `>`: greater than\n\n- `<`: less than\n\n- `>=`: greater than or equal to\n\n- `<=`: less than or equal to\n\nLet us filter based on the continent column. How many continent are there? Create a basic table first\n\n```{r continent_table}\ntable(gapminder$continent)\n```\n\nThere are five continents. Let us filter only observations from the African continent:\n\n```{r filter}\n\nafrica_gapminder <- gapminder |> \n  filter(continent == \"Africa\")\n\nafrica_gapminder  # print \n```\n\n\n`africa_gapminder` object is a dataframe we have just created, with only countries from the African continent. What `filter()` does is to return observations/rows that only meet our conditions:\n\n![](images/visualise_filter.png)\n\nLet us filter a numeric column; for example, we may want to filter countries with population of above 50 million and assign results to an object named high_pop:\n\n```{r filter numeric}\n\nhigh_pop <- gapminder |> \n  filter(pop > 50000000)\n\nhigh_pop ## print\n```\n\nYou can also combine 2 conditions. Let us say we want:\n\n- countries in Africa\n\n- the year 2007\n\n```{r filter_multiple}\nafrica_2007 <- gapminder |> \n  filter(continent == \"Africa\", year == 2007)\n```\n\nFilter rows from the Africa OR Asia\n\n```{r filter_OR}\ngapminder |> \n  filter(continent == \"Africa\" | continent == \"Asia\")\n```\n\nSometimes you may need to filter multiple rows, let say, more than 5 countries. It would be inconvinient to type `country == \"...\"` five times. This is where the `%in%` operator is useful:\n\n```{r the in operator}\nafrica_2007 |> \n  filter(country %in% c(\"South Africa\", \"Zimbabwe\", \"Ghana\", \"Tanzania\", \"Tunisia\"))\n```\n\n### 4.1.6 `arrange()` function\n\n`arrange()` function is self-explanatory: it sort values into ascending or descending order\n\n```{r arrange}\n\nafrica_2007 |> \n  arrange(lifeExp) |> \n  head(n = 10) ## show the first 10 observations\n```\n\nThe default sorting is ascending order; you can sort into descending order by using `desc()` function within `arrange()`:\n\n```{r arrange_descending}\nafrica_2007 |> \n  arrange(desc(lifeExp)) |> \n  head(n = 10) ## show the first 10 observations\n```\n\n### 4.1.7 `summarise()`\n\nWe use the `summarise()` function to get the summary statistics. Common statistics include mean, median, standard deviation, minimum, maximum, etc.\n\n```{r mean}\ngapminder |> \n  summarise(mean_life_exp = mean(lifeExp))\n```\n\nStandard deviation:\n\n```{r SD}\ngapminder |> \n  summarise(sd_life_exp = sd(lifeExp))\n```\n\nYou can get various summary statistics by combing multiple arguments within summarise():\n\n```{r summarise multiple}\ngapminder |> \n  summarise(mean_life_exp = mean(lifeExp),   \n            sd_life_exp = sd(lifeExp),\n            min_life_exp = min(lifeExp),\n            max_life_exp = max(lifeExp))\n```\n\nMagic! \n\n\n### 4.1.8 Aggregate  Statisitcs with `group_by()`\n\nIn many instances we are interested in aggregate statistics, that is, summary statistics by a category. Say you want to group rows by the continent column then get the use `summarise()` to get average GDP per capita for each continent. This is where the `group()` function is useful:\n\n```{r group_by}\n\n## First create a dataframe of the year 2007 only\n\ngapminder_2007 <- gapminder |> \n  filter(year == 2007)\n\n## Then use group_by()\n\ngapminder_2007 |> \n  group_by(continent) |> \n  summarise(gdp_continent = mean(gdpPercap)) |> \n  arrange(desc(gdp_continent))  ## arrange by gdp_continent into descending\n```\n\n\n### 4.1.9 Create columns with `mutate()`\n\nmutate create new columns based on the existing columns. In most cases we want to transform the data. For example, we know that the GDP per capita is calculated from dividing the total GDP by a population. We may want to create a new column named `gdp_total` with a formula (`gdp_total = gdpPercap * pop)`. We can use `mutate()`:\n\n```{r mutate gdp}\ngapminder_2007 <- gapminder_2007 |> \n  mutate(gdp_total = gdpPercap * pop)\n\nhead(gapminder_2007)\n```\n\nYou can see that the new column named `gdp_total` has been added. \n\nYou can also combine multiple arguments within `mutate()`:\n\n```{r mutate_2}\ngapminder_2007 <- gapminder_2007 |> \n  mutate(gdp_total = gdpPercap * pop,\n         life_exp_squared = lifeExp ** 2)\n```\n  \n### Wraping all up\n\nThe pipe operator is very useful. You can chain multiple operations into a single code. Let say we want to do the following:\n\n- Find country called South Africa\n\n- find average life expectancy by year\n\n- Arrange by year into a descending order\n\n```{r multiple operation}\ngapminder |> \n  filter(country == \"South Africa\") |> \n  group_by(year) |> \n  summarise(life_exp = mean(lifeExp)) |> \n  arrange(desc(year))\n```\n\nYou can take it even further by creating a plot. You know that BRICS countries are Brazil, Russia, India, China and South Africa. You want to find trends in life expectancy. Note that there is no data for Russia\n\n```{r line_plot_sa}\ngapminder |> \n  filter(country %in% c(\"Brazil\", \"Russia\", \"India\", \"China\", \"South Africa\")) |> \n  select(country, year, lifeExp) |> \n  ggplot(aes(x = year, y = lifeExp, colour = country)) +\n  geom_line(linewidth = 1.5) +\n  theme_minimal() +\n  scale_x_continuous(breaks = c(1950, 1960, 1980, 1990, 2000, 2007)) +\n  theme(legend.position = \"bottom\",\n        panel.grid.minor = element_blank()) +\n  labs(title = \"Trends in life expectancy of BRICS country\",\n       x = \"\",\n       y = \"Life expectancy (in years)\",\n       caption = \"Data source: Gapminder\")\n```\n\nWait a minute: why did south Africa's life expectancy started to decline rapidly from the 1990s? One plausible reason would be the impact of HIV/AIDS and lack of antiretrovirals (ARVs). Welcome to data analysis.\n\nYou can see above the efficiency of the pipe operator.  Think of the pipe operator as:\n\n![](images/pipe.gif)\n\nOR\n\n![](images/pipe_bake.gif)\n\nWe have introduced to the basics of data manipulation in R using the `dplyr` package in R. While we have covered a lot, the path is long. However, once you master these basic functions, you will not struggle in the following sections. These resources may be helpful:\n\n- [R for Data Science](https://r4ds.hadley.nz/). Chapter 4 \n\n- [Data transformation with dplyr](https://github.com/rstudio/cheatsheets/blob/main/data-transformation.pdf)","srcMarkdownNoYaml":"\n\n\n# 4.1 PART I\n\n## Learning objectives\n\n-   Understand dataframes\n\n-   Manipulate, transform and analyse dataframes\n\n## 4.1.1 Introduction\n\nDataframes, as we saw [the previous section](/weeks/week-2.html), is a tabular data format, with columns and rows. Columns are *variable* names and rows are individual *observations*. \n\nLet us a basic data frame with three columns: country, life expectancy, and population of Southern African countries. First, we create individual vectors:\n\n```{r create a dataframe}\n\n# Create a character vector\ncountry_name <- c(\"Angola\", \"Botswana\", \"Lesotho\", \"Malawi\", \"Mozambique\", \"Namibia\", \"South Africa\", \"Swaziland\", \"Zambia\", \"Zimbabwe\")\n\ncountry_name\n\n## Create a numeric vector\n\nlife_expectancy <- c(61.6, 61.1, 57.1, 53.1, 62.9, 59.3, 59.3, 62.3, 61.2, 59.3)\n\nlife_expectancy\n\n## create another numeric vector\n\npopulation <- c(34500000, 2590000, 228000, 19890000, 32080000,  2530000, 59390000, 1190000, 19470000, 1599000)\n```\n\nBecause we have 3 vectors of equal length, we can create a dataframe, using a `data.frame()` function:\n\n```{r first_dataframe}\n\nsouthern_africa_df <- data.frame(country_name, life_expectancy, population) #combine two vectors to create a dataframe\n\nsouthern_africa_df ## print the dataframe\n```\n\nA dataframe is basically made of vectors (columns). In the `southern_africa_df` dataframe, we have `r ncol(southern_africa_df)` columns: `country_name`, `life_expectancy` `population`. We can extract these elements using the `$` sign:\n\n```{r extract vector}\nsouthern_africa_df$country_name\n\nsouthern_africa_df$life_expectancy\n\nsouthern_africa_df$population\n```\n\n\n## 4.1.3 Using `dplyr`\n\nWe will use  the `dplyr` package to manipulate data. `dplyr` is part of `tidyverse` meta-package and is mostly used to clean, manipulate and transform dataframes. `dplyr` has 5 main verbs/functions:\n\n-   `select()`: for selecting particular columns in a dataframe\n\n-   `filter()`: for sub-setting rows based on the specified criteria\n\n-   `arrange()`: sort rows/observations based (ascending/descending)\n\n-   `summarise()`: for summary statistics\n\n-   `mutate()`: create new columns based on the manipulation of the existing columns.\n\n- `group_by()`: get aggregate statistics by a category\n\n```{r load dplyr, warning=FALSE}\nlibrary(dplyr)\n```\n\nYou can also load `dplyr` by loading the `tidyverse` package; this will load all the packages in in `tidyverse at once. This is useful, for example, when you want to clean and visualise data:\n\n```{r load tidyverse_2, warning=FALSE}\nlibrary(tidyverse)\n```\n\nNote that you will net to install tidyverse if you did not install it from the previous section:\n\n```{r install tidyverse, echo=FALSE}\n\ninstall.packages(\"tidyverse\")\n```\n\n\nLet us load the `gapminder` dataset that we used from the previous week. If you did not install, you will need to do so.\n\n```{r load gapminder}\nlibrary(gapminder)\n```\n\nThan assign it to the object, `gapminder`, using the `<-` operator:\n\n```{r assign gapminder}\n\ngapminder <- gapminder\n\n```\n\nWrite the following code to change the country and continent from factor to character, I will explain this in the next chapter:\n\n```{r to character}\ngapminder$country <- as.character(gapminder$country)\n\ngapminder$continent <- as.character(gapminder$continent)\n```\n\n\nNow you have an object, which is a dataframe, called `gapminder`, you can see it in the `Environment` pane in RStudio. It shows that it has `ncol(gapminder)` columns/variables and `nrow(gapminder)` observations/rows\n\n![`gapminder` dataframe in Environment pane](images/environment_pane.png)\n\nYou can use the `str()` fucntion to get the structure of the dataframe:\n\n```{r structure of gapminder}\n\nstr(gapminder)\n```\n\nWe have 6 variables:\n\n- \"country\" \n\n- \"continent\" \n\n- \"year\"      \n\n- \"lifeExp\": life expectancy of a country  \n\n- \"pop\": population     \n\n- \"gdpPercap\": GDP per capita\n\nYou can get a sample of the first observations/rows using `head()` function:\n\n```{r head}\nhead(gapminder)\n```\n\n### 4.1.4 `select()` function\n\nWe may be interested in some of the columns in the `gampminder` dataframe, let say, for example, \"country\" and \"pop\" variables and discard others; we use the `select()` function:\n\n```{r select}\nlibrary(dplyr)\nselect(gapminder, \"country\", \"pop\")\n```\n\nR return only the country and population variables. `select()` function only return the variables/columns we are interested in:\n\n![](images/visualise_select.png)\n\n\n### The pipe operator (`|>`)\n\nThe best way to work with R, esepcially tidyverse, is using the pipe (`|>`) operator. The pipe connect various tasks, for example:\n\n```{r pipe}\ngapminder |>\n  select(country, pop)\n```\n\nThe pipe chains your operations. It says:\n\n- Take `gapminder` dataframe\n\n- Then using the `select()` function to select only pop and country columns\n\nYou will that pipe becomes important when having multiple chains of functions at once.\n\nYou will notice that in other sources: web, books, etc. have %>% instead of |>. It works the same way. The |> is new. %>% comes from `mgttr`, an external package, so you needed to load it first before using it. The  native pipe |> is built in R, so it there is no need to load it. So, we will stick with the |>.\n\nIn your RStudio, follow these instructions:\n\n- Go to 'Tools' and click on 'Global Options'\n\n- Navigate to 'Code' on the left pane\n\n- Then select the fourth option, \"use native pipe operator, |>\"\n\n- Click 'Apply'\n\nYou can use the short cut `Ctrl + Shift + M ` If you using Windows to insert the pipe instead of typing it. If you are using Mac, use `Cmd + Shift + M`. \n\n### 4.1.4 Return to `select()` function\n\nAs I have said, `select()` only return the columns specified\n\n\n```{r pipe magttr}\n\ngapminder %>% \n  select(country, pop)\n```\n\nAlso, notice that we selected \"country' and \"pop\" columns but did not save them and assigned to an object. To store the results into an object, we have to use assignment operator (`<-`):\n\n```{r assign}\ngapminder_selected <- gapminder |>\n  select(country, pop)\n\ngapminder_selected # print\n```\n\nNow we have saved results as `gapminder_selected`, and we can do other analysis with this object because we have saved it. So, in a nutshell, when you run a code without assigning results into an object, using the `<-` operator, **results will not be saved but will be printed**.\n\nYou can also select columns based by index/position. Let us select only 1st and 3rd coulmns\n\n```{r select index}\ngapminder |> \n  select(1, 3)\n```\n\nOr you can select a range of columns\n\n```{r select_range}\ngapminder |> \n  select(country:year)\n```\n\nHere, we have select columns from country to year only.\n\nYou can also exclude certain columns by simply adding the minus (-) sign; let say we want to exclude the `gdpPercap` from the dataframe\n\n```{r select_minus}\ngapminder |> \n  select(-gdpPercap)\n```\n\n### 4.1.5 `filter()` function\n\nYou may be interested in observations/rows that meet certain conditions. We use `filter()` function to return the list that meet our conditions. `filter()` has several operators:\n\n- `==`: equal to\n\n- `!=`: not equal to\n\n- `>`: greater than\n\n- `<`: less than\n\n- `>=`: greater than or equal to\n\n- `<=`: less than or equal to\n\nLet us filter based on the continent column. How many continent are there? Create a basic table first\n\n```{r continent_table}\ntable(gapminder$continent)\n```\n\nThere are five continents. Let us filter only observations from the African continent:\n\n```{r filter}\n\nafrica_gapminder <- gapminder |> \n  filter(continent == \"Africa\")\n\nafrica_gapminder  # print \n```\n\n\n`africa_gapminder` object is a dataframe we have just created, with only countries from the African continent. What `filter()` does is to return observations/rows that only meet our conditions:\n\n![](images/visualise_filter.png)\n\nLet us filter a numeric column; for example, we may want to filter countries with population of above 50 million and assign results to an object named high_pop:\n\n```{r filter numeric}\n\nhigh_pop <- gapminder |> \n  filter(pop > 50000000)\n\nhigh_pop ## print\n```\n\nYou can also combine 2 conditions. Let us say we want:\n\n- countries in Africa\n\n- the year 2007\n\n```{r filter_multiple}\nafrica_2007 <- gapminder |> \n  filter(continent == \"Africa\", year == 2007)\n```\n\nFilter rows from the Africa OR Asia\n\n```{r filter_OR}\ngapminder |> \n  filter(continent == \"Africa\" | continent == \"Asia\")\n```\n\nSometimes you may need to filter multiple rows, let say, more than 5 countries. It would be inconvinient to type `country == \"...\"` five times. This is where the `%in%` operator is useful:\n\n```{r the in operator}\nafrica_2007 |> \n  filter(country %in% c(\"South Africa\", \"Zimbabwe\", \"Ghana\", \"Tanzania\", \"Tunisia\"))\n```\n\n### 4.1.6 `arrange()` function\n\n`arrange()` function is self-explanatory: it sort values into ascending or descending order\n\n```{r arrange}\n\nafrica_2007 |> \n  arrange(lifeExp) |> \n  head(n = 10) ## show the first 10 observations\n```\n\nThe default sorting is ascending order; you can sort into descending order by using `desc()` function within `arrange()`:\n\n```{r arrange_descending}\nafrica_2007 |> \n  arrange(desc(lifeExp)) |> \n  head(n = 10) ## show the first 10 observations\n```\n\n### 4.1.7 `summarise()`\n\nWe use the `summarise()` function to get the summary statistics. Common statistics include mean, median, standard deviation, minimum, maximum, etc.\n\n```{r mean}\ngapminder |> \n  summarise(mean_life_exp = mean(lifeExp))\n```\n\nStandard deviation:\n\n```{r SD}\ngapminder |> \n  summarise(sd_life_exp = sd(lifeExp))\n```\n\nYou can get various summary statistics by combing multiple arguments within summarise():\n\n```{r summarise multiple}\ngapminder |> \n  summarise(mean_life_exp = mean(lifeExp),   \n            sd_life_exp = sd(lifeExp),\n            min_life_exp = min(lifeExp),\n            max_life_exp = max(lifeExp))\n```\n\nMagic! \n\n\n### 4.1.8 Aggregate  Statisitcs with `group_by()`\n\nIn many instances we are interested in aggregate statistics, that is, summary statistics by a category. Say you want to group rows by the continent column then get the use `summarise()` to get average GDP per capita for each continent. This is where the `group()` function is useful:\n\n```{r group_by}\n\n## First create a dataframe of the year 2007 only\n\ngapminder_2007 <- gapminder |> \n  filter(year == 2007)\n\n## Then use group_by()\n\ngapminder_2007 |> \n  group_by(continent) |> \n  summarise(gdp_continent = mean(gdpPercap)) |> \n  arrange(desc(gdp_continent))  ## arrange by gdp_continent into descending\n```\n\n\n### 4.1.9 Create columns with `mutate()`\n\nmutate create new columns based on the existing columns. In most cases we want to transform the data. For example, we know that the GDP per capita is calculated from dividing the total GDP by a population. We may want to create a new column named `gdp_total` with a formula (`gdp_total = gdpPercap * pop)`. We can use `mutate()`:\n\n```{r mutate gdp}\ngapminder_2007 <- gapminder_2007 |> \n  mutate(gdp_total = gdpPercap * pop)\n\nhead(gapminder_2007)\n```\n\nYou can see that the new column named `gdp_total` has been added. \n\nYou can also combine multiple arguments within `mutate()`:\n\n```{r mutate_2}\ngapminder_2007 <- gapminder_2007 |> \n  mutate(gdp_total = gdpPercap * pop,\n         life_exp_squared = lifeExp ** 2)\n```\n  \n### Wraping all up\n\nThe pipe operator is very useful. You can chain multiple operations into a single code. Let say we want to do the following:\n\n- Find country called South Africa\n\n- find average life expectancy by year\n\n- Arrange by year into a descending order\n\n```{r multiple operation}\ngapminder |> \n  filter(country == \"South Africa\") |> \n  group_by(year) |> \n  summarise(life_exp = mean(lifeExp)) |> \n  arrange(desc(year))\n```\n\nYou can take it even further by creating a plot. You know that BRICS countries are Brazil, Russia, India, China and South Africa. You want to find trends in life expectancy. Note that there is no data for Russia\n\n```{r line_plot_sa}\ngapminder |> \n  filter(country %in% c(\"Brazil\", \"Russia\", \"India\", \"China\", \"South Africa\")) |> \n  select(country, year, lifeExp) |> \n  ggplot(aes(x = year, y = lifeExp, colour = country)) +\n  geom_line(linewidth = 1.5) +\n  theme_minimal() +\n  scale_x_continuous(breaks = c(1950, 1960, 1980, 1990, 2000, 2007)) +\n  theme(legend.position = \"bottom\",\n        panel.grid.minor = element_blank()) +\n  labs(title = \"Trends in life expectancy of BRICS country\",\n       x = \"\",\n       y = \"Life expectancy (in years)\",\n       caption = \"Data source: Gapminder\")\n```\n\nWait a minute: why did south Africa's life expectancy started to decline rapidly from the 1990s? One plausible reason would be the impact of HIV/AIDS and lack of antiretrovirals (ARVs). Welcome to data analysis.\n\nYou can see above the efficiency of the pipe operator.  Think of the pipe operator as:\n\n![](images/pipe.gif)\n\nOR\n\n![](images/pipe_bake.gif)\n\nWe have introduced to the basics of data manipulation in R using the `dplyr` package in R. While we have covered a lot, the path is long. However, once you master these basic functions, you will not struggle in the following sections. These resources may be helpful:\n\n- [R for Data Science](https://r4ds.hadley.nz/). Chapter 4 \n\n- [Data transformation with dplyr](https://github.com/rstudio/cheatsheets/blob/main/data-transformation.pdf)"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":true,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","filters":["../include-files.lua","quarto"],"css":["../styles.css"],"toc":true,"output-file":"week-3.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.433","theme":{"light":"cosmo","dark":["cosmo","../theme-dark.scss"]},"code-background":true,"code-copy":true,"title":"4 Data Wrangling and Manipulation","tidy":true,"code-annotations":"below"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}